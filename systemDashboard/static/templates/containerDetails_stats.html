

<div class="container-fluid d-flex justify-content-between">
    <div class="mr-auto"><h6>CPU</h6></div>

    <form class="form-inline">
        <label for="strategyCPU">Strategy:</label>
        <select id="strategyCPU" class="form-control custom-select custom-select-sm">
            <option value="continuous" >Continuous (CPU intensive)</option>
            <option value="discrete">Discrete</option>
            <option value="static" selected>Static</option>
        </select>
    </form>
</div>
<div id="visualizationCPU"></div>
<br>
<div class="container-fluid d-flex justify-content-between">
    <div class="mr-auto"><h6>MEM</h6></div>
    <form class="form-inline">
        <label for="strategyMEM">Strategy:</label>
        <select id="strategyMEM" class="form-control custom-select custom-select-sm">
            <option value="continuous" >Continuous (CPU intensive)</option>
            <option value="discrete">Discrete</option>
            <option value="static" selected>Static</option>
        </select>
    </form>
</div>
<div id="visualizationMEM"></div>



<script type="text/javascript">
    var DELAY = 1000; // delay in ms to add new data points

    var strategyCPU = document.getElementById('strategyCPU');
    var strategyMEM = document.getElementById('strategyMEM');

    // create a graph2d with an (currently empty) dataset
    var containerCPU = document.getElementById('visualizationCPU');
    var containerMEM = document.getElementById('visualizationMEM');
    var datasetCPU = new vis.DataSet();
    var datasetMEM = new vis.DataSet();

    var optionsCPU = {
        start: vis.moment().add(-60, 'seconds'), // changed so its faster
        end: vis.moment(),
        dataAxis: {
            left: {
                range: {
                    min:0, max: 110
                }
            }
        },
        drawPoints: {
            style: 'circle' // square, circle
        },
        shaded: {
            orientation: 'bottom' // top, bottom
        }
    };

    var optionsMEM = {
        start: vis.moment().add(-60, 'seconds'), // changed so its faster
        end: vis.moment(),
        dataAxis: {
            left: {
                range: {
                    min:0, max: 110
                }
            }
        },
        drawPoints: {
            style: 'circle' // square, circle
        },
        shaded: {
            orientation: 'bottom' // top, bottom
        }
    };

    var graph2dCPU = new vis.Graph2d(containerCPU, datasetCPU, optionsCPU);
    var graph2dMEM = new vis.Graph2d(containerMEM, datasetMEM, optionsMEM);

    // a function to generate data points
    function y(x) {
        return ((Math.sin(x / 2) + Math.cos(x / 4)) * 5) + 50;
    }

    function renderStep(graph, strategy) {

        //console.log(graph.getWindow, typeof graph.getWindow);
        // move the window (you can think of different strategies).
        var now = vis.moment();
        var range = graph.getWindow();
        var interval = range.end - range.start;
        switch (strategy.value) {
            case 'continuous':                                  // THIS ONE IS NOT WORKING CORRECTLY!!!!
                // continuously move the window
                graph.setWindow(now - interval, now, {animation: false});
                requestAnimationFrame(() => {renderStep(graph,strategy);});
                break;

            case 'discrete':
                graph.setWindow(now - interval, now, {animation: false});
                setTimeout(() => {renderStep(graph, strategy)}, DELAY);
                break;

            default: // 'static'
                // move the window 90% to the left when now is larger than the end of the window
                if (now > range.end) {
                    graph.setWindow(now - 0.1 * interval, now + 0.9 * interval);
                }
                setTimeout(() => {renderStep(graph, strategy)}, DELAY);
                break;
        }
    }
    renderStep(graph2dCPU, strategyCPU);
    renderStep(graph2dMEM, strategyMEM);

    /**
     * Add a new datapoint to the graph
     */
    function addDataPoint(graph, dataset) {
        // add a new data point to the dataset
        var now = vis.moment();
        dataset.add({
            x: now,
            y: y(now / 1000)
        });

        // remove all data points which are no longer visible
        var range = graph.getWindow();
        var interval = range.end - range.start;
        var oldIds = dataset.getIds({
            filter: function (item) {
                return item.x < range.start - interval;
            }
        });
        dataset.remove(oldIds);

        setTimeout(() => {addDataPoint(graph, dataset)}, DELAY);
    }
    addDataPoint(graph2dCPU, datasetCPU);
    addDataPoint(graph2dMEM, datasetMEM);
</script>